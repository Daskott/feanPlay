var app=angular.module("app",["ngRoute","ngCookies"]);angular.module("app").controller("ApplicationCtrl",["$scope","$rootScope","$location","UserService",function(o,e,t,n){o.currentUser=e.globals.currentUser,o.$on("login",function(){o.currentUser=e.globals.currentUser}),o.logout=function(){n.clearCredentials(),o.currentUser=null,t.path("/")}}]);var app=angular.module("app");app.controller("LoginCtrl",["$scope","$rootScope","$location","UserService",function(o,e,t,n){o.invalidLogin=!1,o.login=function(e,r){n.login(e,r).then(function(e){o.invalidLogin=!1,o.$emit("login"),t.path("/home")})["catch"](function(e){o.invalidLogin=!0,console.error("Login Error",e.status)})}}]);var app=angular.module("app");app.controller("PostsCtrl",["$scope","PostsService",function(o,e){e.fetch().success(function(e){o.posts=e}),o.addPost=function(){o.postBody&&e.create({body:o.postBody}).success(function(e){o.postBody=null})},o.$on("ws:new_post",function(e,t){console.log("GOT IT"),o.$apply(function(){o.posts.unshift(t)})})}]);var app=angular.module("app");app.service("PostsService",["$http",function(o){this.fetch=function(){return o.get("/api/posts")},this.create=function(e){return o.post("/api/posts",e)}}]);var app=angular.module("app");app.controller("RegisterCtrl",["$scope","$location","UserService",function(o,e,t){o.register=function(o,n,r){o&&r&&n&&t.register(o,n,r).then(function(n){t.login(o,r),e.path("/login")})}}]),function(){"use strict";function o(o,e){o.when("/home",{controller:"PostsCtrl",templateUrl:"posts.html"}).when("/register",{controller:"RegisterCtrl",templateUrl:"register.html"}).when("/",{controller:"LoginCtrl",templateUrl:"login.html"}).otherwise({redirectTo:"/"})}function e(o,e,t,n){o.globals=t.get("globals")||{},o.globals.currentUser&&(console.log("hello"),n.defaults.headers.common["x-auth"]=o.globals.currentUser.authdata),o.$on("$locationChangeStart",function(t,n,r){var a=-1===$.inArray(e.path(),["/","/register"]),s=o.globals.currentUser;a&&!s?e.path("/"):s&&e.path("/home")})}angular.module("app").config(o).run(e),o.$inject=["$routeProvider","$locationProvider"],e.$inject=["$rootScope","$location","$cookieStore","$http"]}();var app=angular.module("app");app.service("UserService",["$http","$rootScope","$cookieStore",function(o,e,t){var n=this;n.getUser=function(){return o.get("/api/users")},n.login=function(e,t){return o.post("/api/sessions",{username:e,password:t}).then(function(o){return n.token=o.data,n.setCredentials(n.token),n.getUser()})},n.register=function(e,t,n){return o.post("/api/users",{username:e,email:t,password:n})},n.setCredentials=function(n){var r=n;o.get("/api/users",{headers:{"x-auth":n}}).success(function(n){e.globals={currentUser:{username:n.username,email:n.email,authdata:r}},t.put("globals",e.globals),o.defaults.headers.common["x-auth"]=r})},n.clearCredentials=function(){e.globals={},t.remove("globals"),o.defaults.headers.common.Authorization=null}}]);var app=angular.module("app"),addr="localhost";app.run(["$rootScope","$timeout",function(o,e){!function t(){var n="ws://"+addr+":5000",r=new WebSocket(n);r.onclose=function(o){console.log("WebSocket closed. Reconnecting..."),e(t,1e4)},r.onmessage=function(e){var t=JSON.parse(e.data);console.log("recieve broadcast"),o.$broadcast("ws:"+t.topic,t.data)}}()}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImFwcGxpY2F0aW9uQ29udHJvbGxlci5qcyIsImxvZ2luQ29udHJvbGxlci5qcyIsInBvc3RDb250cm9sbGVyLmpzIiwicG9zdFNlcnZpY2UuanMiLCJyZWdpc3RlckNvbnRyb2xsZXIuanMiLCJyb3V0ZXMuanMiLCJ1c2VyU2VydmljZS5qcyIsIndlYnNvY2tldHNMaXN0ZW5lci5qcyJdLCJuYW1lcyI6WyJhcHAiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29udHJvbGxlciIsIiRzY29wZSIsIiRyb290U2NvcGUiLCIkbG9jYXRpb24iLCJVc2VyU2VydmljZSIsImN1cnJlbnRVc2VyIiwiZ2xvYmFscyIsIiRvbiIsImxvZ291dCIsImNsZWFyQ3JlZGVudGlhbHMiLCJwYXRoIiwiaW52YWxpZExvZ2luIiwibG9naW4iLCJ1c2VybmFtZSIsInBhc3N3b3JkIiwidGhlbiIsInJlc3BvbnNlIiwiJGVtaXQiLCJjb25zb2xlIiwiZXJyb3IiLCJzdGF0dXMiLCJQb3N0c1NlcnZpY2UiLCJmZXRjaCIsInN1Y2Nlc3MiLCJwb3N0cyIsImFkZFBvc3QiLCJwb3N0Qm9keSIsImNyZWF0ZSIsImJvZHkiLCJfIiwicG9zdCIsImxvZyIsIiRhcHBseSIsInVuc2hpZnQiLCJzZXJ2aWNlIiwiJGh0dHAiLCJ0aGlzIiwiZ2V0IiwicmVnaXN0ZXIiLCJlbWFpbCIsImNvbmZpZyIsIiRyb3V0ZVByb3ZpZGVyIiwiJGxvY2F0aW9uUHJvdmlkZXIiLCJ3aGVuIiwidGVtcGxhdGVVcmwiLCJvdGhlcndpc2UiLCJyZWRpcmVjdFRvIiwicnVuIiwiJGNvb2tpZVN0b3JlIiwiZGVmYXVsdHMiLCJoZWFkZXJzIiwiY29tbW9uIiwiYXV0aGRhdGEiLCJldmVudCIsIm5leHQiLCJjdXJyZW50IiwicmVzdHJpY3RlZFBhZ2UiLCIkIiwiaW5BcnJheSIsImxvZ2dlZEluIiwiJGluamVjdCIsInN2YyIsImdldFVzZXIiLCJ2YWwiLCJ0b2tlbiIsImRhdGEiLCJzZXRDcmVkZW50aWFscyIsIngtYXV0aCIsInVzZXIiLCJwdXQiLCJyZW1vdmUiLCJBdXRob3JpemF0aW9uIiwiYWRkciIsIiR0aW1lb3V0IiwiY29ubmVjdCIsInVybCIsImNvbm5lY3Rpb24iLCJXZWJTb2NrZXQiLCJvbmNsb3NlIiwiZSIsIm9ubWVzc2FnZSIsInBheWxvYWQiLCJKU09OIiwicGFyc2UiLCIkYnJvYWRjYXN0IiwidG9waWMiXSwibWFwcGluZ3MiOiJBQUNBLEdBQUFBLEtBQUFDLFFBQUFDLE9BQUEsT0FDQSxVQUNBLGFDSEFELFNBQUFDLE9BQUEsT0FDQUMsV0FBQSxtQkFBQSxTQUFBLGFBQUEsWUFBQSxjQUFBLFNBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEdBR0FILEVBQUFJLFlBQUFILEVBQUFJLFFBQUFELFlBR0FKLEVBQUFNLElBQUEsUUFBQSxXQUNBTixFQUFBSSxZQUFBSCxFQUFBSSxRQUFBRCxjQUdBSixFQUFBTyxPQUFBLFdBQ0FKLEVBQUFLLG1CQUNBUixFQUFBSSxZQUFBLEtBQ0FGLEVBQUFPLEtBQUEsUUNkQSxJQUFBYixLQUFBQyxRQUFBQyxPQUFBLE1BQ0FGLEtBQUFHLFdBQUEsYUFBQSxTQUFBLGFBQUEsWUFBQSxjQUFBLFNBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEdBRUFILEVBQUFVLGNBQUEsRUFFQVYsRUFBQVcsTUFBQSxTQUFBQyxFQUFBQyxHQUNBVixFQUFBUSxNQUFBQyxFQUFBQyxHQUNBQyxLQUFBLFNBQUFDLEdBQ0FmLEVBQUFVLGNBQUEsRUFDQVYsRUFBQWdCLE1BQUEsU0FDQWQsRUFBQU8sS0FBQSxXQUpBTixTQUtBLFNBQUFZLEdBQ0FmLEVBQUFVLGNBQUEsRUFDQU8sUUFBQUMsTUFBQSxjQUFBSCxFQUFBSSxhQ1pBLElBQUF2QixLQUFBQyxRQUFBQyxPQUFBLE1BSUFGLEtBQUFHLFdBQUEsYUFBQSxTQUFBLGVBQUEsU0FBQUMsRUFBQW9CLEdBR0FBLEVBQUFDLFFBQUFDLFFBQUEsU0FBQUMsR0FDQXZCLEVBQUF1QixNQUFBQSxJQUdBdkIsRUFBQXdCLFFBQUEsV0FH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QUMsT0FBQSxVQUFBQyxLQUtBUyxFQUFBcEQsaUJBQUEsV0FDQVAsRUFBQUksV0FDQTBDLEVBQUFzQixPQUFBLFdBQ0FuQyxFQUFBYyxTQUFBQyxRQUFBQyxPQUFBb0IsY0FBQSxRQy9DQSxJQUFBMUUsS0FBQUMsUUFBQUMsT0FBQSxPQUNBeUUsS0FBQSxXQUNBM0UsS0FBQWtELEtBQUEsYUFBQSxXQUFBLFNBQUE3QyxFQUFBdUUsSUFDQSxRQUFBQyxLQUNBLEdBQUFDLEdBQUEsUUFBQUgsS0FBQSxRQUNBSSxFQUFBLEdBQUFDLFdBQUFGLEVBQ0FDLEdBQUFFLFFBQUEsU0FBQUMsR0FDQTdELFFBQUFhLElBQUEscUNBQ0EwQyxFQUFBQyxFQUFBLE1BRUFFLEVBQUFJLFVBQUEsU0FBQUQsR0FDQSxHQUFBRSxHQUFBQyxLQUFBQyxNQUFBSixFQUFBZCxLQUNBL0MsU0FBQWEsSUFBQSxxQkFDQTdCLEVBQUFrRixXQUFBLE1BQUFILEVBQUFJLE1BQUFKLEVBQUFoQiIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvL2p1c3QgZGVmaW5lIG1vZHVsZSAmIGl0cyBkZXBlbmRlbmNpZXNcbnZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJywgW1xuICAnbmdSb3V0ZScsXG4gICduZ0Nvb2tpZXMnXG5dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuLmNvbnRyb2xsZXIoJ0FwcGxpY2F0aW9uQ3RybCcsIGZ1bmN0aW9uICgkc2NvcGUsICRyb290U2NvcGUsICRsb2NhdGlvbiwgVXNlclNlcnZpY2UpIHtcblxuICAvL3doZW4gdXNlciByZWZyZXNoZXMgcGFnZSwgbWsgc3VyZSB1c2UgaXMgc2V0XG4gICRzY29wZS5jdXJyZW50VXNlciA9ICAkcm9vdFNjb3BlLmdsb2JhbHMuY3VycmVudFVzZXI7XG5cbiAgLy93aGVuIHVzZXIgbG9ncyBpbiwgcmVjZWl2ZSBzaWduYWwgb24gbG9naW5cbiAgJHNjb3BlLiRvbignbG9naW4nLCBmdW5jdGlvbiAoKSB7XG4gICAgICRzY29wZS5jdXJyZW50VXNlciA9ICRyb290U2NvcGUuZ2xvYmFscy5jdXJyZW50VXNlcjtcbiAgfSk7XG5cbiAgJHNjb3BlLmxvZ291dCA9IGZ1bmN0aW9uICgpIHtcbiAgICBVc2VyU2VydmljZS5jbGVhckNyZWRlbnRpYWxzKCk7XG4gICAgJHNjb3BlLmN1cnJlbnRVc2VyID0gbnVsbDtcbiAgICAkbG9jYXRpb24ucGF0aCgnLycpOyAvL2dvIGJhY2sgdG8gc2lnaW4gcGFnZVxuICB9XG5cbiB9KTtcbiIsInZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XG5hcHAuY29udHJvbGxlcignTG9naW5DdHJsJywgZnVuY3Rpb24gKCRzY29wZSwgJHJvb3RTY29wZSwgJGxvY2F0aW9uLCBVc2VyU2VydmljZSkge1xuXG4gICRzY29wZS5pbnZhbGlkTG9naW4gPSBmYWxzZTtcblxuICAkc2NvcGUubG9naW4gPSBmdW5jdGlvbiAodXNlcm5hbWUsIHBhc3N3b3JkKSB7XG4gICAgVXNlclNlcnZpY2UubG9naW4odXNlcm5hbWUsIHBhc3N3b3JkKVxuICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgJHNjb3BlLmludmFsaWRMb2dpbiA9IGZhbHNlO1xuICAgICAgJHNjb3BlLiRlbWl0KCdsb2dpbicpO1xuICAgICAgJGxvY2F0aW9uLnBhdGgoJy9ob21lJyk7XG4gICAgfSkuY2F0Y2goZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICRzY29wZS5pbnZhbGlkTG9naW4gPSB0cnVlO1xuICAgICAgY29uc29sZS5lcnJvcignTG9naW4gRXJyb3InLCByZXNwb25zZS5zdGF0dXMpO1xuICAgIH0pO1xuICB9XG59KTtcbiIsIlxudmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnKTtcblxuLy9kZXBlbmRlbmN5IGluamVjdCAnUG9zdHNTZXJ2aWNlJyAmICckc2NvcGUnXG4vL2Jhc2ljYWxseSwgJyRzY29wZScgaXMgbGlrZSAndGhpcydcbmFwcC5jb250cm9sbGVyKCdQb3N0c0N0cmwnLCBmdW5jdGlvbiAoJHNjb3BlLCBQb3N0c1NlcnZpY2UpIHtcblxuICAvL2dldCBwb3N0c1xuICBQb3N0c1NlcnZpY2UuZmV0Y2goKS5zdWNjZXNzKGZ1bmN0aW9uIChwb3N0cykgeyAvL3RoZW5bd2hlbiB0ZXN0aW5nXVxuICAgICRzY29wZS5wb3N0cyA9IHBvc3RzO1xuICB9KTtcblxuICAkc2NvcGUuYWRkUG9zdCA9IGZ1bmN0aW9uICgpIHtcblxuICAgIC8vcHVzaCBpdGVtIHRvIGRiICYgdG8gdG9wIG9mIGFycmF5KCBpZiBpbnNlcnQgc3VjY2VzZnVsKVxuICAgIGlmKCRzY29wZS5wb3N0Qm9keSl7IC8vZ2V0IGN1cnIgdXNlciBuYW1lXG4gICAgICBQb3N0c1NlcnZpY2UuY3JlYXRlKHtib2R5OiAkc2NvcGUucG9zdEJvZHkgfSkuc3VjY2VzcyhmdW5jdGlvbiAocG9zdHMpIHtcbiAgICAgICAgLy8kc2NvcGUucG9zdHMudW5zaGlmdCggeyB1c2VybmFtZTogJHNjb3BlLmN1cnJlbnRVc2VyLnVzZXJuYW1lLCBib2R5OiAkc2NvcGUucG9zdEJvZHkgfSk7XG4gICAgICAgICRzY29wZS5wb3N0Qm9keSA9IG51bGw7IC8vY2xlYXIgaW5wdXQgZmllbGRcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gICRzY29wZS4kb24oJ3dzOm5ld19wb3N0JywgZnVuY3Rpb24gKF8sIHBvc3QpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdHT1QgSVQnKTtcbiAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAkc2NvcGUucG9zdHMudW5zaGlmdChwb3N0KVxuICAgICAgfSk7XG4gIH0pO1xuXG59KTtcbiIsInZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XG5cbmFwcC5zZXJ2aWNlKCdQb3N0c1NlcnZpY2UnLCBmdW5jdGlvbigkaHR0cCl7XG5cbiAgLy9nZXQgcG9zdHNcbiAgdGhpcy5mZXRjaCA9IGZ1bmN0aW9uKCl7XG4gICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS9wb3N0cycpO1xuICB9XG5cbiAgLy9jcmVhdGUgcG9zdHNcbiAgdGhpcy5jcmVhdGUgPSBmdW5jdGlvbihwb3N0KXtcbiAgICByZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9wb3N0cycsIHBvc3QpO1xuICB9XG5cbn0pO1xuIiwidmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnKTtcclxuYXBwLmNvbnRyb2xsZXIoJ1JlZ2lzdGVyQ3RybCcsIGZ1bmN0aW9uICgkc2NvcGUsICRsb2NhdGlvbiwgVXNlclNlcnZpY2UpIHtcclxuXHJcbiAgJHNjb3BlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKHVzZXJuYW1lLCBlbWFpbCwgcGFzc3dvcmQpIHtcclxuXHJcbiAgICBpZih1c2VybmFtZSAmJiBwYXNzd29yZCAmJiBlbWFpbClcclxuICAgIHtcclxuICAgICAgVXNlclNlcnZpY2UucmVnaXN0ZXIodXNlcm5hbWUsIGVtYWlsLCBwYXNzd29yZClcclxuICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcblxyXG4gICAgICAgIC8vY29uc29sZS5sb2codXNlcm5hbWUsIHBhc3N3b3JkKTtcclxuICAgICAgICBVc2VyU2VydmljZS5sb2dpbih1c2VybmFtZSwgcGFzc3dvcmQpOyAvL3NldCB1c2VyIGNyZWRlbnRpYWxzXHJcbiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9sb2dpbicpOyAvL3JlZGlyZWN0IHRvIGxvZ2kgcGFnZVxyXG4gICAgICAgIC8vY29uc29sZS5sb2cocmVzcG9uc2UpO1xyXG5cclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gIH1cclxufSk7XHJcbiIsIlxuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5jb25maWcoY29uZmlnKVxuICAgICAgICAucnVuKHJ1bik7XG5cbiAgICBjb25maWcuJGluamVjdCA9IFsnJHJvdXRlUHJvdmlkZXInLCAnJGxvY2F0aW9uUHJvdmlkZXInXTtcbiAgICBmdW5jdGlvbiBjb25maWcoJHJvdXRlUHJvdmlkZXIsICRsb2NhdGlvblByb3ZpZGVyKSB7XG4gICAgICAgICRyb3V0ZVByb3ZpZGVyXG4gICAgICAgICAgLndoZW4oJy9ob21lJywgeyBjb250cm9sbGVyOiAnUG9zdHNDdHJsJywgdGVtcGxhdGVVcmw6ICdwb3N0cy5odG1sJyB9KVxuICAgICAgICAgIC53aGVuKCcvcmVnaXN0ZXInLCB7IGNvbnRyb2xsZXI6ICdSZWdpc3RlckN0cmwnLCB0ZW1wbGF0ZVVybDogJ3JlZ2lzdGVyLmh0bWwnIH0pXG4gICAgICAgICAgLndoZW4oJy8nLCB7IGNvbnRyb2xsZXI6ICdMb2dpbkN0cmwnLCB0ZW1wbGF0ZVVybDogJ2xvZ2luLmh0bWwnIH0pXG4gICAgICAgICAgLm90aGVyd2lzZSh7IHJlZGlyZWN0VG86ICcvJyB9KTtcbiAgICB9XG5cbiAgICBydW4uJGluamVjdCA9IFsnJHJvb3RTY29wZScsICckbG9jYXRpb24nLCAnJGNvb2tpZVN0b3JlJywgJyRodHRwJ107XG4gICAgZnVuY3Rpb24gcnVuKCRyb290U2NvcGUsICRsb2NhdGlvbiwgJGNvb2tpZVN0b3JlLCAkaHR0cCkge1xuICAgICAgICAvLyBrZWVwIHVzZXIgbG9nZ2VkIGluIGFmdGVyIHBhZ2UgcmVmcmVzaFxuICAgICAgICAkcm9vdFNjb3BlLmdsb2JhbHMgPSAkY29va2llU3RvcmUuZ2V0KCdnbG9iYWxzJykgfHwge307XG4gICAgICAgIGlmICgkcm9vdFNjb3BlLmdsb2JhbHMuY3VycmVudFVzZXIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiaGVsbG9cIik7XG4gICAgICAgICAgICAkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsneC1hdXRoJ10gPSAkcm9vdFNjb3BlLmdsb2JhbHMuY3VycmVudFVzZXIuYXV0aGRhdGE7IC8vIGpzaGludCBpZ25vcmU6bGluZVxuICAgICAgICB9XG5cbiAgICAgICAgJHJvb3RTY29wZS4kb24oJyRsb2NhdGlvbkNoYW5nZVN0YXJ0JywgZnVuY3Rpb24gKGV2ZW50LCBuZXh0LCBjdXJyZW50KSB7XG4gICAgICAgICAgICAvLyByZWRpcmVjdCB0byBsb2dpbiBwYWdlIGlmIG5vdCBsb2dnZWQgaW4gYW5kIHRyeWluZyB0byBhY2Nlc3MgYSByZXN0cmljdGVkIHBhZ2VcbiAgICAgICAgICAgIHZhciByZXN0cmljdGVkUGFnZSA9ICQuaW5BcnJheSgkbG9jYXRpb24ucGF0aCgpLCBbJy8nLCAnL3JlZ2lzdGVyJ10pID09PSAtMTtcbiAgICAgICAgICAgIHZhciBsb2dnZWRJbiA9ICRyb290U2NvcGUuZ2xvYmFscy5jdXJyZW50VXNlcjtcbiAgICAgICAgICAgIGlmIChyZXN0cmljdGVkUGFnZSAmJiAhbG9nZ2VkSW4pIHtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy9pZiBsb2dnZWQgaW4sIHUgY2FuJ3QgZ28gdG8gYW55IG90aGVyIGxpbmsgYXBhcnQgZnJvbSBob21lXG4gICAgICAgICAgICBlbHNlIGlmIChsb2dnZWRJbikge1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvaG9tZScpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0pO1xuICAgIH1cblxufSkoKTtcbiIsInZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XG5hcHAuc2VydmljZSgnVXNlclNlcnZpY2UnLCBmdW5jdGlvbiAoJGh0dHAsICAgJHJvb3RTY29wZSwgJGNvb2tpZVN0b3JlKSB7XG4gIHZhciBzdmMgPSB0aGlzO1xuXG4gIHN2Yy5nZXRVc2VyID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiAkaHR0cC5nZXQoJy9hcGkvdXNlcnMnKTsvLywgeyBoZWFkZXJzOiB7ICdYLUF1dGgnOiB0aGlzLnRva2VuIH0gfSk7XG4gIH1cblxuICBzdmMubG9naW4gPSBmdW5jdGlvbiAodXNlcm5hbWUsIHBhc3N3b3JkKSB7XG4gICAgcmV0dXJuICRodHRwLnBvc3QoJy9hcGkvc2Vzc2lvbnMnLCB7IHVzZXJuYW1lOiB1c2VybmFtZSwgcGFzc3dvcmQ6IHBhc3N3b3JkIH0pXG4gICAgLnRoZW4oZnVuY3Rpb24gKHZhbCkge1xuICAgICAgc3ZjLnRva2VuID0gdmFsLmRhdGE7XG4gICAgICAvL2luY2x1ZGUgaGVhZGVyIGdsb2JhbGx5LCBzbyB1IGRvbid0IGhhdmUgdG8gZG8gaXQgb24gZXZlcnkgcmVxdWVzdFxuICAgICAgc3ZjLnNldENyZWRlbnRpYWxzKHN2Yy50b2tlbik7XG4gICAgICByZXR1cm4gc3ZjLmdldFVzZXIoKTtcbiAgICB9KTtcbiAgfVxuXG4gIHN2Yy5yZWdpc3RlciA9IGZ1bmN0aW9uICh1c2VybmFtZSwgZW1haWwsIHBhc3N3b3JkKSB7XG4gICAgcmV0dXJuICRodHRwLnBvc3QoJy9hcGkvdXNlcnMnLCB7IHVzZXJuYW1lOiB1c2VybmFtZSwgZW1haWw6IGVtYWlsLCBwYXNzd29yZDogcGFzc3dvcmQgfSk7XG4gIH1cblxuICAvL3NldCBjcmVkZW50aWFsc1xuICBzdmMuc2V0Q3JlZGVudGlhbHMgPSBmdW5jdGlvbih0b2tlbil7XG5cbiAgICAvL2dldCB1c2VyIGNyZWRlbnRpYWxzICYgc3RvcmUgaXQgZ2xvYmFsbHlcbiAgICB2YXIgYXV0aGRhdGEgPSB0b2tlbjtcbiAgICAkaHR0cC5nZXQoJy9hcGkvdXNlcnMnLCB7IGhlYWRlcnM6IHsgJ3gtYXV0aCc6IHRva2VuIH0gfSlcbiAgICAuc3VjY2VzcyhmdW5jdGlvbih1c2VyKXtcbiAgICAgICRyb290U2NvcGUuZ2xvYmFscyA9IHtcbiAgICAgICAgICBjdXJyZW50VXNlcjoge1xuICAgICAgICAgICAgICB1c2VybmFtZTogdXNlci51c2VybmFtZSxcbiAgICAgICAgICAgICAgZW1haWw6IHVzZXIuZW1haWwsXG4gICAgICAgICAgICAgIGF1dGhkYXRhOiBhdXRoZGF0YVxuICAgICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIC8vc2V0IHRva2VuIGZvciBhbGwgcmVxdWVzdFxuICAgICAgJGNvb2tpZVN0b3JlLnB1dCgnZ2xvYmFscycsICRyb290U2NvcGUuZ2xvYmFscyk7XG4gICAgICAkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsneC1hdXRoJ10gPSBhdXRoZGF0YTsgLy8ganNoaW50IGlnbm9yZTpsaW5lXG4gICAgfSk7XG4gIH1cblxuICAvL2NsZWFyQ3JlZGVudGlhbHNcbiAgc3ZjLmNsZWFyQ3JlZGVudGlhbHMgID0gZnVuY3Rpb24gKCkge1xuICAgICAgJHJvb3RTY29wZS5nbG9iYWxzID0ge307XG4gICAgICAkY29va2llU3RvcmUucmVtb3ZlKCdnbG9iYWxzJyk7XG4gICAgICAkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vbi5BdXRob3JpemF0aW9uID0gbnVsbDtcbiAgfVxuXG5cbn0pO1xuIiwidmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnKTtcclxudmFyIGFkZHIgPSAnbG9jYWxob3N0JztcclxuYXBwLnJ1bihmdW5jdGlvbiAoJHJvb3RTY29wZSwgJHRpbWVvdXQpIHtcclxuXHQoZnVuY3Rpb24gY29ubmVjdCgpIHtcclxuXHRcdHZhciB1cmwgPSAnd3M6Ly8nK2FkZHIrJzo1MDAwJztcclxuXHRcdHZhciBjb25uZWN0aW9uID0gbmV3IFdlYlNvY2tldCh1cmwpO1xyXG5cdFx0Y29ubmVjdGlvbi5vbmNsb3NlID0gZnVuY3Rpb24gKGUpIHtcclxuXHRcdFx0Y29uc29sZS5sb2coJ1dlYlNvY2tldCBjbG9zZWQuIFJlY29ubmVjdGluZy4uLicpO1xyXG5cdFx0XHQkdGltZW91dChjb25uZWN0LCAxMCoxMDAwKTtcclxuXHRcdH1cclxuXHRcdGNvbm5lY3Rpb24ub25tZXNzYWdlID0gZnVuY3Rpb24gKGUpIHtcclxuXHRcdFx0dmFyIHBheWxvYWQgPSBKU09OLnBhcnNlKGUuZGF0YSk7XHJcblx0XHRcdGNvbnNvbGUubG9nKCdyZWNpZXZlIGJyb2FkY2FzdCcpXHJcblx0XHRcdCRyb290U2NvcGUuJGJyb2FkY2FzdCgnd3M6JyArIHBheWxvYWQudG9waWMsIHBheWxvYWQuZGF0YSk7XHJcblx0XHR9XHJcblx0fSkoKTtcclxufSk7XHJcblxyXG5cclxuLy8gLnNlcnZpY2UoJ1dlYlNvY2tldFN2YycsIGZ1bmN0aW9uICgkcm9vdFNjb3BlKSB7XHJcbi8vIFx0ZnVuY3Rpb24gd2Vic29ja2V0SG9zdCgpIHtcclxuLy8gXHRcdGlmICgkd2luZG93LmxvY2F0aW9uLnByb3Qgb2NvbCA9PT0gXCJodHRwczpcIikge1xyXG4vLyBcdFx0XHRyZXR1cm4gXCJ3c3M6Ly9cIiArIHdpbmRvdy5sb2NhdGlvbi5ob3N0XHJcbi8vIFx0XHR9IGVsc2Uge1xyXG4vLyBcdFx0XHRyZXR1cm4gXCJ3czovL1wiICsgd2luZG93LmxvY2F0aW9uLmhvc3RcclxuLy8gXHRcdH1cclxuLy8gXHR9XHJcbi8vIFx0dmFyIGNvbm5lY3Rpb24gdGhpcy5jb25uZWN0ID0gZnVuY3Rpb24gKCkge1xyXG4vLyBcdFx0Y29ubmVjdGlvbiA9IG5ldyBXZWJTb2NrZXQod2Vic29ja2V0SG9zdCgpKSBjb25uZWN0aW9uLm9ubWVzc2FnZSA9IGZ1bmN0aW9uIChlKSB7XHJcbi8vIFx0XHRcdHZhciBwYXlsb2FkID0gSlNPTi5wYXJzZShlLmRhdGEpICRyb290U2NvcGUuJGJyb2FkY2FzdCgnd3M6JyArIHBheWxvYWQudG9waWMsIHBheWxvYWQuZGF0YSlcclxuLy8gXHRcdH1cclxuLy8gXHR9XHJcbi8vIFx0dGhpcy5zZW5kID0gZnVuY3Rpb24gKHRvcGljLCBkYXRhKSB7XHJcbi8vIFx0XHR2YXIganNvbiA9IEpTT04uc3RyaW5naWZ5KHt0b3BpYzogdG9waWMsIGRhdGE6IGRhdGFcclxuLy8gXHRcdH0pXHJcbi8vIFx0XHRjb25uZWN0aW9uLnNlbmQoanNvbilcclxuLy8gXHR9XHJcbi8vIH0pLnJ1bihmdW5jdGlvbiAoV2ViU29ja2V0U3ZjKSB7XHJcbi8vIFx0V2ViU29ja2V0U3ZjLmNvbm5lY3QoKVxyXG4vLyB9KVxyXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
