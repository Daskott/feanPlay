var app=angular.module("app",["ngRoute","ngCookies","firebase"]);angular.module("app").controller("ApplicationCtrl",["$scope","$rootScope","$location","UserService",function(e,t,r,o){e.currentUser=t.globals.currentUser,e.$on("login",function(){e.currentUser=t.globals.currentUser}),e.logout=function(){o.clearCredentials(),e.currentUser=null,r.path("/")}}]);var app=angular.module("app");app.controller("LoginCtrl",["$scope","$rootScope","$location","UserService",function(e,t,r,o){e.invalidLogin=!1,e.login=function(t,n){o.login(t,n).then(function(t){e.invalidLogin=!1,e.$emit("login"),r.path("/home")})["catch"](function(t){e.invalidLogin=!0,console.error("Login Error",t.status)})}}]);var app=angular.module("app");app.controller("PostsCtrl",["$scope","$firebaseArray","PostsService",function(e,t,r){var o=firebase.database().ref().child("posts");e.posts=t(o),e.addPost=function(){var t=(new Date).getTime();if(e.postBody){var r={username:e.currentUser.username,body:e.postBody,time:t};o.push().set(r),e.postBody=null}}}]);var app=angular.module("app");app.service("PostsService",["$http",function(e){this.fetch=function(){return e.get("/api/posts")},this.create=function(t){return e.post("/api/posts",t)}}]);var app=angular.module("app");app.controller("RegisterCtrl",["$scope","$location","UserService",function(e,t,r){e.register=function(e,o,n){e&&n&&o&&r.register(e,o,n).then(function(o){r.login(e,n),t.path("/login")})}}]),function(){"use strict";function e(e,t){e.when("/home",{controller:"PostsCtrl",templateUrl:"posts.html"}).when("/register",{controller:"RegisterCtrl",templateUrl:"register.html"}).when("/",{controller:"LoginCtrl",templateUrl:"login.html"}).otherwise({redirectTo:"/"})}function t(e,t,r,o){e.globals=r.get("globals")||{},e.globals.currentUser&&(o.defaults.headers.common["x-auth"]=e.globals.currentUser.authdata),e.$on("$locationChangeStart",function(r,o,n){var a=-1===$.inArray(t.path(),["/","/register"]),s=e.globals.currentUser;a&&!s?t.path("/"):s&&t.path("/home")})}angular.module("app").config(e).run(t),e.$inject=["$routeProvider","$locationProvider"],t.$inject=["$rootScope","$location","$cookieStore","$http"]}();var app=angular.module("app");app.service("UserService",["$http","$rootScope","$cookieStore",function(e,t,r){var o=this;o.getUser=function(){return e.get("/api/users")},o.login=function(t,r){return e.post("/api/sessions",{username:t,password:r}).then(function(e){return o.token=e.data,o.setCredentials(o.token),o.getUser()})},o.register=function(t,r,o){return e.post("/api/users",{username:t,email:r,password:o})},o.setCredentials=function(o){var n=o;e.get("/api/users",{headers:{"x-auth":o}}).success(function(o){t.globals={currentUser:{username:o.username,email:o.email,authdata:n}},r.put("globals",t.globals),e.defaults.headers.common["x-auth"]=n})},o.clearCredentials=function(){t.globals={},r.remove("globals"),e.defaults.headers.common.Authorization=null}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImFwcGxpY2F0aW9uQ29udHJvbGxlci5qcyIsImxvZ2luQ29udHJvbGxlci5qcyIsInBvc3RDb250cm9sbGVyLmpzIiwicG9zdFNlcnZpY2UuanMiLCJyZWdpc3RlckNvbnRyb2xsZXIuanMiLCJyb3V0ZXMuanMiLCJ1c2VyU2VydmljZS5qcyJdLCJuYW1lcyI6WyJhcHAiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29udHJvbGxlciIsIiRzY29wZSIsIiRyb290U2NvcGUiLCIkbG9jYXRpb24iLCJVc2VyU2VydmljZSIsImN1cnJlbnRVc2VyIiwiZ2xvYmFscyIsIiRvbiIsImxvZ291dCIsImNsZWFyQ3JlZGVudGlhbHMiLCJwYXRoIiwiaW52YWxpZExvZ2luIiwibG9naW4iLCJ1c2VybmFtZSIsInBhc3N3b3JkIiwidGhlbiIsInJlc3BvbnNlIiwiJGVtaXQiLCJjb25zb2xlIiwiZXJyb3IiLCJzdGF0dXMiLCIkZmlyZWJhc2VBcnJheSIsIlBvc3RzU2VydmljZSIsImRhdGFiYXNlUmVmIiwiZmlyZWJhc2UiLCJkYXRhYmFzZSIsInJlZiIsImNoaWxkIiwicG9zdHMiLCJhZGRQb3N0IiwidGltZVN0YW1wIiwiRGF0ZSIsImdldFRpbWUiLCJwb3N0Qm9keSIsInBvc3QiLCJib2R5IiwidGltZSIsInB1c2giLCJzZXQiLCJzZXJ2aWNlIiwiJGh0dHAiLCJ0aGlzIiwiZmV0Y2giLCJnZXQiLCJjcmVhdGUiLCJyZWdpc3RlciIsImVtYWlsIiwiY29uZmlnIiwiJHJvdXRlUHJvdmlkZXIiLCIkbG9jYXRpb25Qcm92aWRlciIsIndoZW4iLCJ0ZW1wbGF0ZVVybCIsIm90aGVyd2lzZSIsInJlZGlyZWN0VG8iLCJydW4iLCIkY29va2llU3RvcmUiLCJkZWZhdWx0cyIsImhlYWRlcnMiLCJjb21tb24iLCJhdXRoZGF0YSIsImV2ZW50IiwibmV4dCIsImN1cnJlbnQiLCJyZXN0cmljdGVkUGFnZSIsIiQiLCJpbkFycmF5IiwibG9nZ2VkSW4iLCIkaW5qZWN0Iiwic3ZjIiwiZ2V0VXNlciIsInZhbCIsInRva2VuIiwiZGF0YSIsInNldENyZWRlbnRpYWxzIiwieC1hdXRoIiwic3VjY2VzcyIsInVzZXIiLCJwdXQiLCJyZW1vdmUiLCJBdXRob3JpemF0aW9uIl0sIm1hcHBpbmdzIjoiQUFDQSxHQUFBQSxLQUFBQyxRQUFBQyxPQUFBLE9BQ0EsVUFDQSxZQUNBLFlDSkFELFNBQUFDLE9BQUEsT0FDQUMsV0FBQSxtQkFBQSxTQUFBLGFBQUEsWUFBQSxjQUFBLFNBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEdBR0FILEVBQUFJLFlBQUFILEVBQUFJLFFBQUFELFlBR0FKLEVBQUFNLElBQUEsUUFBQSxXQUNBTixFQUFBSSxZQUFBSCxFQUFBSSxRQUFBRCxjQUdBSixFQUFBTyxPQUFBLFdBQ0FKLEVBQUFLLG1CQUNBUixFQUFBSSxZQUFBLEtBQ0FGLEVBQUFPLEtBQUEsUUNkQSxJQUFBYixLQUFBQyxRQUFBQyxPQUFBLE1BQ0FGLEtBQUFHLFdBQUEsYUFBQSxTQUFBLGFBQUEsWUFBQSxjQUFBLFNBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEdBRUFILEVBQUFVLGNBQUEsRUFFQVYsRUFBQVcsTUFBQSxTQUFBQyxFQUFBQyxHQUNBVixFQUFBUSxNQUFBQyxFQUFBQyxHQUNBQyxLQUFBLFNBQUFDLEdBQ0FmLEVBQUFVLGNBQUEsRUFDQVYsRUFBQWdCLE1BQUEsU0FDQWQsRUFBQU8sS0FBQSxXQUpBTixTQUtBLFNBQUFZLEdBQ0FmLEVBQUFVLGNBQUEsRUFDQU8sUUFBQUMsTUFBQSxjQUFBSCxFQUFBSSxhQ1pBLElBQUF2QixLQUFBQyxRQUFBQyxPQUFBLE1BRUFGLEtBQUFHLFdBQUEsYUFBQSxTQUFBLGlCQUFBLGVBQUEsU0FBQUMsRUFBQW9CLEVBQUFDLEdBd0JBLEdBQUFDLEdBQUFDLFNBQUFDLFdBQUFDLE1BQUFDLE1BQUEsUUFHQTFCLEdBQUEyQixNQUFBUCxFQUFBRSxHQUdBdEIsRUFBQTRCLFFBQUEsV0FDQSxHQUFBQyxJQUFBLEdBQUFDLE9BQUFDLFNBQ0EsSUFB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QUNBdEMsRUFBQWdCLFNBQUFDLFFBQUFDLE9BQUFxQixjQUFBIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vanVzdCBkZWZpbmUgbW9kdWxlICYgaXRzIGRlcGVuZGVuY2llc1xudmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnLCBbXG4gICduZ1JvdXRlJyxcbiAgJ25nQ29va2llcycsXG4gICdmaXJlYmFzZSdcbl0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4uY29udHJvbGxlcignQXBwbGljYXRpb25DdHJsJywgZnVuY3Rpb24gKCRzY29wZSwgJHJvb3RTY29wZSwgJGxvY2F0aW9uLCBVc2VyU2VydmljZSkge1xuXG4gIC8vd2hlbiB1c2VyIHJlZnJlc2hlcyBwYWdlLCBtayBzdXJlIHVzZSBpcyBzZXRcbiAgJHNjb3BlLmN1cnJlbnRVc2VyID0gICRyb290U2NvcGUuZ2xvYmFscy5jdXJyZW50VXNlcjtcblxuICAvL3doZW4gdXNlciBsb2dzIGluLCByZWNlaXZlIHNpZ25hbCBvbiBsb2dpblxuICAkc2NvcGUuJG9uKCdsb2dpbicsIGZ1bmN0aW9uICgpIHtcbiAgICAgJHNjb3BlLmN1cnJlbnRVc2VyID0gJHJvb3RTY29wZS5nbG9iYWxzLmN1cnJlbnRVc2VyO1xuICB9KTtcblxuICAkc2NvcGUubG9nb3V0ID0gZnVuY3Rpb24gKCkge1xuICAgIFVzZXJTZXJ2aWNlLmNsZWFyQ3JlZGVudGlhbHMoKTtcbiAgICAkc2NvcGUuY3VycmVudFVzZXIgPSBudWxsO1xuICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7IC8vZ28gYmFjayB0byBzaWdpbiBwYWdlXG4gIH1cblxuIH0pO1xuIiwidmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnKTtcbmFwcC5jb250cm9sbGVyKCdMb2dpbkN0cmwnLCBmdW5jdGlvbiAoJHNjb3BlLCAkcm9vdFNjb3BlLCAkbG9jYXRpb24sIFVzZXJTZXJ2aWNlKSB7XG5cbiAgJHNjb3BlLmludmFsaWRMb2dpbiA9IGZhbHNlO1xuXG4gICRzY29wZS5sb2dpbiA9IGZ1bmN0aW9uICh1c2VybmFtZSwgcGFzc3dvcmQpIHtcbiAgICBVc2VyU2VydmljZS5sb2dpbih1c2VybmFtZSwgcGFzc3dvcmQpXG4gICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAkc2NvcGUuaW52YWxpZExvZ2luID0gZmFsc2U7XG4gICAgICAkc2NvcGUuJGVtaXQoJ2xvZ2luJyk7XG4gICAgICAkbG9jYXRpb24ucGF0aCgnL2hvbWUnKTtcbiAgICB9KS5jYXRjaChmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgJHNjb3BlLmludmFsaWRMb2dpbiA9IHRydWU7XG4gICAgICBjb25zb2xlLmVycm9yKCdMb2dpbiBFcnJvcicsIHJlc3BvbnNlLnN0YXR1cyk7XG4gICAgfSk7XG4gIH1cbn0pO1xuIiwiXG52YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2FwcCcpO1xuXG5hcHAuY29udHJvbGxlcignUG9zdHNDdHJsJywgZnVuY3Rpb24gKCRzY29wZSwgICRmaXJlYmFzZUFycmF5LCBQb3N0c1NlcnZpY2UpIHtcblxuXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG5cbkZpcmVCYXNlIEltcGxlbWVudGF0aW9uXG5cbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuXG5cbi8vICB7XG4vLyAgIFwicnVsZXNcIjoge1xuLy8gICAgIFwiLnJlYWRcIjogXCJhdXRoICE9IG51bGxcIixcbi8vICAgICBcIi53cml0ZVwiOiBcImF1dGggIT0gbnVsbFwiXG4vLyAgIH1cbi8vIH1cblxuXG4gIC8vIHZhciBhcHAgPSBmaXJlYmFzZS5pbml0aWFsaXplQXBwKGNvbmZpZyk7XG4gIC8vdmFyIGRhdGFiYXNlID0gYXBwLmRhdGFiYXNlKCk7XG4gIC8vdmFyIGF1dGggPSBhcHAuYXV0aCgpO1xuICAvL3ZhciBzdG9yYWdlID0gYXBwLnN0b3JhZ2UoKTtcblxuICAvL2dldCByZWZlcmVuY2UgdG8gb3VyIHBvc3RzIGluIHRoZSBkYXRhYmFzZVxuICB2YXIgZGF0YWJhc2VSZWYgPSBmaXJlYmFzZS5kYXRhYmFzZSgpLnJlZigpLmNoaWxkKCdwb3N0cycpO1xuXG4gIC8vZ2V0IHBvc3QgJiB1cGRhdGUgVUlcbiAgJHNjb3BlLnBvc3RzID0gJGZpcmViYXNlQXJyYXkoZGF0YWJhc2VSZWYpO1xuXG4gIC8vc2F2ZSBwb3N0IHRvIHJlYWxUaW1lIGRiXG4gICRzY29wZS5hZGRQb3N0ID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciB0aW1lU3RhbXAgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICBpZigkc2NvcGUucG9zdEJvZHkpe1xuXG4gICAgICAgIHZhciBwb3N0ID0ge1xuICAgICAgICAgIHVzZXJuYW1lOiAkc2NvcGUuY3VycmVudFVzZXIudXNlcm5hbWUsXG4gICAgICAgICAgYm9keTogJHNjb3BlLnBvc3RCb2R5LFxuICAgICAgICAgIHRpbWU6IHRpbWVTdGFtcFxuICAgICAgICB9XG4gICAgICAgIGRhdGFiYXNlUmVmLnB1c2goKS5zZXQocG9zdCk7XG4gICAgICAgICRzY29wZS5wb3N0Qm9keSA9IG51bGw7IC8vY2xlYXIgaW5wdXQgZmllbGRcbiAgICB9XG4gIH1cblxuICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gICogVXNlciBhdXRoZW50aWNhdGlvbiB3aXRoIGZpcmViYXNlXG4gICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cbiAgLy9sb2dpbiBhdXRoXG4gIC8vICRzY29wZS5nb29nbGUgPSBmdW5jdGlvbigpe1xuICAvLyAgIGF1dGguc2lnbkluV2l0aFBvcHVwKG5ldyBmaXJlYmFzZS5hdXRoLkdvb2dsZUF1dGhQcm92aWRlcigpKTtcbiAgLy8gfVxuICAvL1xuICAvLyBhdXRoLm9uQXV0aFN0YXRlQ2hhbmdlZChmdW5jdGlvbih1c2VyKSB7XG4gIC8vICAgaWYgKHVzZXIpIHtcbiAgLy8gICAgIC8vIFVzZXIgaXMgc2lnbmVkIGluLlxuICAvLyAgICAgJHNjb3BlLmN1cnJlbnRVc2VyLnVzZXJuYW1lID0gdXNlci5kaXNwbGF5TmFtZTtcbiAgLy8gICB9IGVsc2Uge1xuICAvLyAgICAgLy8gTm8gdXNlciBpcyBzaWduZWQgaW4uXG4gIC8vICAgfVxuICAvLyB9KTtcbiAgLy9cblxufSk7XG4iLCJ2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2FwcCcpO1xuXG5hcHAuc2VydmljZSgnUG9zdHNTZXJ2aWNlJywgZnVuY3Rpb24oJGh0dHApe1xuXG4gIC8vZ2V0IHBvc3RzXG4gIHRoaXMuZmV0Y2ggPSBmdW5jdGlvbigpe1xuICAgIHJldHVybiAkaHR0cC5nZXQoJy9hcGkvcG9zdHMnKTtcbiAgfVxuXG4gIC8vY3JlYXRlIHBvc3RzXG4gIHRoaXMuY3JlYXRlID0gZnVuY3Rpb24ocG9zdCl7XG4gICAgcmV0dXJuICRodHRwLnBvc3QoJy9hcGkvcG9zdHMnLCBwb3N0KTtcbiAgfVxuXG59KTtcbiIsInZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XHJcbmFwcC5jb250cm9sbGVyKCdSZWdpc3RlckN0cmwnLCBmdW5jdGlvbiAoJHNjb3BlLCAkbG9jYXRpb24sIFVzZXJTZXJ2aWNlKSB7XHJcblxyXG4gICRzY29wZS5yZWdpc3RlciA9IGZ1bmN0aW9uICh1c2VybmFtZSwgZW1haWwsIHBhc3N3b3JkKSB7XHJcblxyXG4gICAgaWYodXNlcm5hbWUgJiYgcGFzc3dvcmQgJiYgZW1haWwpXHJcbiAgICB7XHJcbiAgICAgIFVzZXJTZXJ2aWNlLnJlZ2lzdGVyKHVzZXJuYW1lLCBlbWFpbCwgcGFzc3dvcmQpXHJcbiAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG5cclxuICAgICAgICAvL2NvbnNvbGUubG9nKHVzZXJuYW1lLCBwYXNzd29yZCk7XHJcbiAgICAgICAgVXNlclNlcnZpY2UubG9naW4odXNlcm5hbWUsIHBhc3N3b3JkKTsgLy9zZXQgdXNlciBjcmVkZW50aWFsc1xyXG4gICAgICAgICRsb2NhdGlvbi5wYXRoKCcvbG9naW4nKTsgLy9yZWRpcmVjdCB0byBsb2dpIHBhZ2VcclxuICAgICAgICAvL2NvbnNvbGUubG9nKHJlc3BvbnNlKTtcclxuXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICB9XHJcbn0pO1xyXG4iLCJcbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuY29uZmlnKGNvbmZpZylcbiAgICAgICAgLnJ1bihydW4pO1xuXG4gICAgY29uZmlnLiRpbmplY3QgPSBbJyRyb3V0ZVByb3ZpZGVyJywgJyRsb2NhdGlvblByb3ZpZGVyJ107XG4gICAgZnVuY3Rpb24gY29uZmlnKCRyb3V0ZVByb3ZpZGVyLCAkbG9jYXRpb25Qcm92aWRlcikge1xuICAgICAgICAkcm91dGVQcm92aWRlclxuICAgICAgICAgIC53aGVuKCcvaG9tZScsIHsgY29udHJvbGxlcjogJ1Bvc3RzQ3RybCcsIHRlbXBsYXRlVXJsOiAncG9zdHMuaHRtbCcgfSlcbiAgICAgICAgICAud2hlbignL3JlZ2lzdGVyJywgeyBjb250cm9sbGVyOiAnUmVnaXN0ZXJDdHJsJywgdGVtcGxhdGVVcmw6ICdyZWdpc3Rlci5odG1sJyB9KVxuICAgICAgICAgIC53aGVuKCcvJywgeyBjb250cm9sbGVyOiAnTG9naW5DdHJsJywgdGVtcGxhdGVVcmw6ICdsb2dpbi5odG1sJyB9KVxuICAgICAgICAgIC5vdGhlcndpc2UoeyByZWRpcmVjdFRvOiAnLycgfSk7XG4gICAgfVxuXG4gICAgcnVuLiRpbmplY3QgPSBbJyRyb290U2NvcGUnLCAnJGxvY2F0aW9uJywgJyRjb29raWVTdG9yZScsICckaHR0cCddO1xuICAgIGZ1bmN0aW9uIHJ1bigkcm9vdFNjb3BlLCAkbG9jYXRpb24sICRjb29raWVTdG9yZSwgJGh0dHApIHtcbiAgICAgICAgXG4gICAgICAgIC8vIGtlZXAgdXNlciBsb2dnZWQgaW4gYWZ0ZXIgcGFnZSByZWZyZXNoXG4gICAgICAgICRyb290U2NvcGUuZ2xvYmFscyA9ICRjb29raWVTdG9yZS5nZXQoJ2dsb2JhbHMnKSB8fCB7fTtcbiAgICAgICAgaWYgKCRyb290U2NvcGUuZ2xvYmFscy5jdXJyZW50VXNlcikge1xuICAgICAgICAgICAgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ3gtYXV0aCddID0gJHJvb3RTY29wZS5nbG9iYWxzLmN1cnJlbnRVc2VyLmF1dGhkYXRhOyAvLyBqc2hpbnQgaWdub3JlOmxpbmVcbiAgICAgICAgfVxuXG4gICAgICAgICRyb290U2NvcGUuJG9uKCckbG9jYXRpb25DaGFuZ2VTdGFydCcsIGZ1bmN0aW9uIChldmVudCwgbmV4dCwgY3VycmVudCkge1xuICAgICAgICAgICAgLy8gcmVkaXJlY3QgdG8gbG9naW4gcGFnZSBpZiBub3QgbG9nZ2VkIGluIGFuZCB0cnlpbmcgdG8gYWNjZXNzIGEgcmVzdHJpY3RlZCBwYWdlXG4gICAgICAgICAgICB2YXIgcmVzdHJpY3RlZFBhZ2UgPSAkLmluQXJyYXkoJGxvY2F0aW9uLnBhdGgoKSwgWycvJywgJy9yZWdpc3RlciddKSA9PT0gLTE7XG4gICAgICAgICAgICB2YXIgbG9nZ2VkSW4gPSAkcm9vdFNjb3BlLmdsb2JhbHMuY3VycmVudFVzZXI7XG4gICAgICAgICAgICBpZiAocmVzdHJpY3RlZFBhZ2UgJiYgIWxvZ2dlZEluKSB7XG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vaWYgbG9nZ2VkIGluLCB1IGNhbid0IGdvIHRvIGFueSBvdGhlciBsaW5rIGFwYXJ0IGZyb20gaG9tZVxuICAgICAgICAgICAgZWxzZSBpZiAobG9nZ2VkSW4pIHtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2hvbWUnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9KTtcbiAgICB9XG5cbn0pKCk7XG4iLCJ2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2FwcCcpO1xuYXBwLnNlcnZpY2UoJ1VzZXJTZXJ2aWNlJywgZnVuY3Rpb24gKCRodHRwLCAgICRyb290U2NvcGUsICRjb29raWVTdG9yZSkge1xuICB2YXIgc3ZjID0gdGhpcztcblxuICBzdmMuZ2V0VXNlciA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VzZXJzJyk7Ly8sIHsgaGVhZGVyczogeyAnWC1BdXRoJzogdGhpcy50b2tlbiB9IH0pO1xuICB9XG5cbiAgc3ZjLmxvZ2luID0gZnVuY3Rpb24gKHVzZXJuYW1lLCBwYXNzd29yZCkge1xuICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3Nlc3Npb25zJywgeyB1c2VybmFtZTogdXNlcm5hbWUsIHBhc3N3b3JkOiBwYXNzd29yZCB9KVxuICAgIC50aGVuKGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgIHN2Yy50b2tlbiA9IHZhbC5kYXRhO1xuICAgICAgLy9pbmNsdWRlIGhlYWRlciBnbG9iYWxseSwgc28gdSBkb24ndCBoYXZlIHRvIGRvIGl0IG9uIGV2ZXJ5IHJlcXVlc3RcbiAgICAgIHN2Yy5zZXRDcmVkZW50aWFscyhzdmMudG9rZW4pO1xuICAgICAgcmV0dXJuIHN2Yy5nZXRVc2VyKCk7XG4gICAgfSk7XG4gIH1cblxuICBzdmMucmVnaXN0ZXIgPSBmdW5jdGlvbiAodXNlcm5hbWUsIGVtYWlsLCBwYXNzd29yZCkge1xuICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3VzZXJzJywgeyB1c2VybmFtZTogdXNlcm5hbWUsIGVtYWlsOiBlbWFpbCwgcGFzc3dvcmQ6IHBhc3N3b3JkIH0pO1xuICB9XG5cbiAgLy9zZXQgY3JlZGVudGlhbHNcbiAgc3ZjLnNldENyZWRlbnRpYWxzID0gZnVuY3Rpb24odG9rZW4pe1xuXG4gICAgLy9nZXQgdXNlciBjcmVkZW50aWFscyAmIHN0b3JlIGl0IGdsb2JhbGx5XG4gICAgdmFyIGF1dGhkYXRhID0gdG9rZW47XG4gICAgJGh0dHAuZ2V0KCcvYXBpL3VzZXJzJywgeyBoZWFkZXJzOiB7ICd4LWF1dGgnOiB0b2tlbiB9IH0pXG4gICAgLnN1Y2Nlc3MoZnVuY3Rpb24odXNlcil7XG4gICAgICAkcm9vdFNjb3BlLmdsb2JhbHMgPSB7XG4gICAgICAgICAgY3VycmVudFVzZXI6IHtcbiAgICAgICAgICAgICAgdXNlcm5hbWU6IHVzZXIudXNlcm5hbWUsXG4gICAgICAgICAgICAgIGVtYWlsOiB1c2VyLmVtYWlsLFxuICAgICAgICAgICAgICBhdXRoZGF0YTogYXV0aGRhdGFcbiAgICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICAvL3NldCB0b2tlbiBmb3IgYWxsIHJlcXVlc3RcbiAgICAgICRjb29raWVTdG9yZS5wdXQoJ2dsb2JhbHMnLCAkcm9vdFNjb3BlLmdsb2JhbHMpO1xuICAgICAgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ3gtYXV0aCddID0gYXV0aGRhdGE7IC8vIGpzaGludCBpZ25vcmU6bGluZVxuICAgIH0pO1xuICB9XG5cbiAgLy9jbGVhckNyZWRlbnRpYWxzXG4gIHN2Yy5jbGVhckNyZWRlbnRpYWxzICA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICRyb290U2NvcGUuZ2xvYmFscyA9IHt9O1xuICAgICAgJGNvb2tpZVN0b3JlLnJlbW92ZSgnZ2xvYmFscycpO1xuICAgICAgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb24uQXV0aG9yaXphdGlvbiA9IG51bGw7XG4gIH1cblxuXG59KTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
